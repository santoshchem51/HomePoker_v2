# Story 4.3: Multiple Export Options

## Status  
**Done** âœ… 

## Story
**As a** poker game organizer,
**I want** different sharing formats for different situations,
**so that** I can share appropriate detail levels based on the context.

## Acceptance Criteria
1. Quick summary format (just settlements)
2. Detailed format (full session breakdown)  
3. Image export option for visual sharing
4. Text-only format for accessibility
5. Copy to clipboard as backup option
6. Session data export for record-keeping

## Technical Context

### Existing Implementation Foundation
- **WhatsAppService** already has formatSummaryMessage() and formatDetailedMessage() methods
- **Story 4.2** enhanced mobile formatting with emoji and professional layout
- **MessageFormat** types support 'summary' and 'detailed' formats
- **Clipboard integration** exists for fallback sharing

### Architecture Requirements
- Extend existing `WhatsAppService` with additional export formats
- Follow service layer pattern for export functionality
- Use shared types from `src/types/` for new export formats
- Maintain financial precision with `CalculationUtils` for all formats
- Consider React Native capabilities for image generation

## Tasks / Subtasks

### Task 1: Implement Additional Message Formats (AC: 1, 2, 4)
- [ ] Extend `src/services/integration/WhatsAppService.ts` with new formats
  - [ ] Create `formatQuickSummary()` method for settlements only (AC 1)
  - [ ] Enhance existing `formatDetailedMessage()` for full breakdown (AC 2)
  - [ ] Add `formatTextOnly()` method for accessibility (AC 4)
  - [ ] Update `MessageFormat` type to include new formats

### Task 2: Implement Copy to Clipboard Functionality (AC: 5)
- [ ] Enhance clipboard integration in `WhatsAppService`
  - [ ] Create `copyToClipboard(content: string, format: MessageFormat)` method
  - [ ] Add format-specific clipboard success notifications
  - [ ] Ensure clipboard works across iOS and Android platforms
  - [ ] Add proper error handling for clipboard failures

### Task 3: Create Session Data Export (AC: 6)
- [ ] Implement structured data export functionality
  - [ ] Create `exportSessionData(sessionId: string): SessionExport` method
  - [ ] Generate JSON format with complete session information
  - [ ] Include player data, transactions, and settlement calculations
  - [ ] Add timestamp and metadata for record-keeping

### Task 4: Implement Image Export Option (AC: 3)
- [ ] Research and implement image generation for mobile
  - [ ] Evaluate React Native image generation libraries (react-native-view-shot)
  - [ ] Create `generateSettlementImage()` method
  - [ ] Design visual layout for settlement summary
  - [ ] Handle image sharing via native share functionality

### Task 5: Update WhatsAppShare Component (AC: 1-6)
- [ ] Enhance `src/screens/Settlement/WhatsAppShare.tsx` with format options
  - [ ] Add format selection UI (Quick, Detailed, Image, Text-only)
  - [ ] Implement export options (WhatsApp, Clipboard, Data export)
  - [ ] Add preview functionality for each format
  - [ ] Update component props and state management

### Task 6: Comprehensive Testing (AC: 1-6)
- [ ] Create unit tests for all new export formats
  - [ ] Test quick summary format accuracy
  - [ ] Verify detailed format completeness
  - [ ] Test clipboard functionality across platforms
  - [ ] Validate session data export structure
  - [ ] Test image generation (if implemented)

## Definition of Done
- [ ] All 6 acceptance criteria implemented and tested
- [ ] Multiple export formats available for different use cases
- [ ] Copy to clipboard works reliably as backup option
- [ ] Session data export provides complete record-keeping capability
- [ ] Image export option functional (or documented alternative)
- [ ] All existing WhatsApp functionality preserved and enhanced
- [ ] Unit tests pass for all new export methods
- [ ] Manual testing confirms format options work across platforms

## Dependencies
- Builds upon Story 4.1 (WhatsApp URL Scheme Integration)
- Builds upon Story 4.2 (Settlement Message Formatting)
- Requires existing `WhatsAppService` and formatting utilities
- May require additional React Native libraries for image generation

## Notes
This story provides flexible export options to meet different sharing needs while building on the enhanced formatting from Story 4.2. Image export may require additional library evaluation and could be implemented as a follow-up enhancement if technical complexity is high.